<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mockvoting.domain.voting.mapper.VoteHistoryMapper">

    <!-- 투표 내역 추가 -->
    <insert id="insertVoteHistory" parameterType="com.example.mockvoting.domain.voting.entity.VoteHistory">
        INSERT INTO vote_history (
            user_id, sg_id, candidate_id, voted_at
        ) VALUES (
                     #{userId}, #{sgId}, #{candidateId}, #{votedAt}
                 )
    </insert>

    <!-- 특정 사용자, 특정 선거의 투표 내역 조회 -->
    <select id="findByUserIdAndSgId" resultType="com.example.mockvoting.domain.voting.entity.VoteHistory">
        SELECT
            id, user_id as userId, sg_id as sgId,
            candidate_id as candidateId, voted_at as votedAt
        FROM vote_history
        WHERE user_id = #{userId} AND sg_id = #{sgId}
            LIMIT 1
    </select>

    <!-- 특정 사용자의 모든 투표 내역 조회 -->
    <select id="findAllByUserId" resultType="com.example.mockvoting.domain.voting.entity.VoteHistory">
        SELECT
            id, user_id as userId, sg_id as sgId,
            candidate_id as candidateId, voted_at as votedAt
        FROM vote_history
        WHERE user_id = #{userId}
        ORDER BY voted_at DESC
    </select>

    <!-- 특정 선거의 모든 투표 내역 조회 (익명화 처리 필요) -->
    <select id="findAllBySgId" resultType="com.example.mockvoting.domain.voting.entity.VoteHistory">
        SELECT
            id, sg_id as sgId,
            candidate_id as candidateId, voted_at as votedAt
        FROM vote_history
        WHERE sg_id = #{sgId}
        ORDER BY voted_at DESC
    </select>

    <!-- 특정 사용자의 투표 총 횟수 조회 -->
    <select id="countByUserId" resultType="int">
        SELECT COUNT(*)
        FROM vote_history
        WHERE user_id = #{userId}
    </select>
</mapper>